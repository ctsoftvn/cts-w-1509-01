tinymce.PluginManager.add('ctsfilemanager', function (editor) {

    function openDialog(elemId, elem, type, objSource) {
        // Khởi tạo biến cục bộ
        var width = window.innerWidth - 40;
        var height = window.innerHeight - 60;
        // Kiểm tra tính hợp lệ
        if (width > 1800) {
            width = 1800;
        }
        if (height > 1200) {
            height = 1200;
        }
        // Trường hợp width lớn hơn 600
        if (width > 600) {
            var tmp = (width - 20) % 138;
            width = width - tmp + 10
        }
        // Lấy loại url
        var urltype = 'file';
        if ('image' === type) {
            urltype = 'image';
        }
        // Lấy chuỗi title
        var title = 'FileManager';
        if ('undefined' !== typeof editor.settings.filemanager_title && editor.settings.filemanager_title) {
            title = editor.settings.filemanager_title;
        }
        // Tiến hành gọi dialog
        tinymce.activeEditor.windowManager.open({
            title: title,
            file: editor.settings.external_filemanager_path + "main.html#?type=" + urltype + "&lang=" + editor.settings.language,
            width: width,
            height: height,
            resizable: true,
            maximizable: true,
            inline: 1
        }, {
            setUrl: function (data) {
                elem = objSource.document.getElementById(elemId);
                elem.value = editor.convertURL(data);
                if ("fireEvent" in elem) {
                    elem.fireEvent("onchange");
                } else {
                    var evt = document.createEvent("HTMLEvents");
                    evt.initEvent("change", false, true);
                    elem.dispatchEvent(evt);
                }
            }
        })
    }
    return tinymce.activeEditor.settings.file_browser_callback = openDialog, false
});